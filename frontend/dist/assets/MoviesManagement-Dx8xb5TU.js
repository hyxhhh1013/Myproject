import{r as u,m as y,a as Y,j as a,d as L}from"./index-BhbzFmRm.js";import{d as te,D as ge}from"./index-EcyMYcYi.js";import{u as se,T as ae,F as R,C as re,B,g as ye,I as F,S as ve,d as be}from"./index-kBbHJYa7.js";import{F as Se,M as je,P as we}from"./Table-B3Aa-BfP.js";import{I as le,K as O,p as Ce,g as Ie,m as Re,r as $e,u as Ee,b as Ve,D as Ne,s as V}from"./index-CEnH4XFE.js";import{R as Me}from"./EditOutlined-Bwl5_b2f.js";import"./index-DcAOwtUU.js";var He={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},K.apply(this,arguments)}const De=(e,t)=>u.createElement(le,K({},e,{ref:t,icon:He})),ze=u.forwardRef(De);var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v576c0 35.3 28.7 64 64 64h592c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM712 792H136V232h576v560zm176-167l-104-59.8V458.9L888 399v226zM208 360h112c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"video-camera",theme:"outlined"};function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},G.apply(this,arguments)}const Oe=(e,t)=>u.createElement(le,G({},e,{ref:t,icon:Fe})),Le=u.forwardRef(Oe);function Te(e,t){const{disabled:r,prefixCls:s,character:h,characterRender:x,index:o,count:S,value:d,allowHalf:w,focused:C,onHover:E,onClick:c}=e,n=v=>{E(v,o)},i=v=>{c(v,o)},N=v=>{v.keyCode===O.ENTER&&c(v,o)},f=o+1,g=new Set([s]);d===0&&o===0&&C?g.add(`${s}-focused`):w&&d+.5>=f&&d<f?(g.add(`${s}-half`),g.add(`${s}-active`),C&&g.add(`${s}-focused`)):(f<=d?g.add(`${s}-full`):g.add(`${s}-zero`),f===d&&C&&g.add(`${s}-focused`));const $=typeof h=="function"?h(e):h;let I=y.createElement("li",{className:Y(Array.from(g)),ref:t},y.createElement("div",{onClick:r?null:i,onKeyDown:r?null:N,onMouseMove:r?null:n,role:"radio","aria-checked":d>o?"true":"false","aria-posinset":o+1,"aria-setsize":S,tabIndex:r?-1:0},y.createElement("div",{className:`${s}-first`},$),y.createElement("div",{className:`${s}-second`},$)));return x&&(I=x(I,e)),I}const Ae=y.forwardRef(Te);function Pe(){const e=u.useRef({});function t(s){return e.current[s]}function r(s){return h=>{e.current[s]=h}}return[t,r]}function Be(e){let t=e.pageXOffset;const r="scrollLeft";if(typeof t!="number"){const s=e.document;t=s.documentElement[r],typeof t!="number"&&(t=s.body[r])}return t}function Ke(e){let t,r;const s=e.ownerDocument,{body:h}=s,x=s&&s.documentElement,o=e.getBoundingClientRect();return t=o.left,r=o.top,t-=x.clientLeft||h.clientLeft||0,r-=x.clientTop||h.clientTop||0,{left:t,top:r}}function Ge(e){const t=Ke(e),r=e.ownerDocument,s=r.defaultView||r.parentWindow;return t.left+=Be(s),t.left}function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},X.apply(this,arguments)}function Xe(e,t){const{prefixCls:r="rc-rate",className:s,defaultValue:h,value:x,count:o=5,allowHalf:S=!1,allowClear:d=!0,keyboard:w=!0,character:C="★",characterRender:E,disabled:c,direction:n="ltr",tabIndex:i=0,autoFocus:N,onHoverChange:f,onChange:g,onFocus:$,onBlur:I,onKeyDown:v,onMouseLeave:M,...H}=e,[T,D]=Pe(),A=y.useRef(null),_=()=>{var l;c||(l=A.current)==null||l.focus()};y.useImperativeHandle(t,()=>({focus:_,blur:()=>{var l;c||(l=A.current)==null||l.blur()}}));const[j,oe]=se(h||0,x),[ce,P]=se(null),U=(l,m)=>{const p=n==="rtl";let b=l+1;if(S){const Q=T(l),Z=Ge(Q),ee=Q.clientWidth;(p&&m-Z>ee/2||!p&&m-Z<ee/2)&&(b-=.5)}return b},z=l=>{oe(l),g==null||g(l)},[ie,W]=y.useState(!1),de=()=>{W(!0),$==null||$()},ue=()=>{W(!1),I==null||I()},[k,q]=y.useState(null),fe=(l,m)=>{const p=U(m,l.pageX);p!==ce&&(q(p),P(null)),f==null||f(p)},J=l=>{c||(q(null),P(null),f==null||f(void 0)),l&&(M==null||M(l))},me=(l,m)=>{const p=U(m,l.pageX);let b=!1;d&&(b=p===j),J(),z(b?0:p),P(b?p:null)},pe=l=>{const{keyCode:m}=l,p=n==="rtl",b=S?.5:1;w&&(m===O.RIGHT&&j<o&&!p?(z(j+b),l.preventDefault()):m===O.LEFT&&j>0&&!p||m===O.RIGHT&&j>0&&p?(z(j-b),l.preventDefault()):m===O.LEFT&&j<o&&p&&(z(j+b),l.preventDefault())),v==null||v(l)};y.useEffect(()=>{N&&!c&&_()},[]);const he=new Array(o).fill(0).map((l,m)=>y.createElement(Ae,{ref:D(m),index:m,count:o,disabled:c,prefixCls:`${r}-star`,allowHalf:S,value:k===null?j:k,onClick:me,onHover:fe,key:l||m,character:C,characterRender:E,focused:ie})),xe=Y(r,s,{[`${r}-disabled`]:c,[`${r}-rtl`]:n==="rtl"});return y.createElement("ul",X({className:xe,onMouseLeave:J,tabIndex:c?-1:i,onFocus:c?null:de,onBlur:c?null:ue,onKeyDown:c?null:pe,ref:A},Ce(H,{aria:!0,data:!0,attr:!0})),he)}const Ye=y.forwardRef(Xe),_e=e=>{const{componentCls:t}=e;return{[`${t}-star`]:{position:"relative",display:"inline-block",color:"inherit",cursor:"pointer","&:not(:last-child)":{marginInlineEnd:e.marginXS},"> div":{transition:`all ${e.motionDurationMid}, outline 0s`,"&:hover":{transform:e.starHoverScale},"&:focus":{outline:0},"&:focus-visible":{outline:`${Ee(e.lineWidth)} dashed ${e.starColor}`,transform:e.starHoverScale}},"&-first, &-second":{color:e.starBg,transition:`all ${e.motionDurationMid}`,userSelect:"none"},"&-first":{position:"absolute",top:0,insetInlineStart:0,width:"50%",height:"100%",overflow:"hidden",opacity:0},[`&-half ${t}-star-first, &-half ${t}-star-second`]:{opacity:1},[`&-half ${t}-star-first, &-full ${t}-star-second`]:{color:"inherit"}}}},Ue=e=>({[`&-rtl${e.componentCls}`]:{direction:"rtl"}}),We=e=>{const{componentCls:t}=e;return{[t]:{...$e(e),display:"inline-block",margin:0,padding:0,color:e.starColor,fontSize:e.starSize,lineHeight:1,listStyle:"none",outline:"none","&-small":{fontSize:e.starSizeSM},"&-large":{fontSize:e.starSizeLG},[`&-disabled${t} ${t}-star`]:{cursor:"default","> div:hover":{transform:"scale(1)"}},..._e(e),...Ue(e)}}},ke=e=>({starColor:e.yellow6,starSize:e.controlHeight*.625,starSizeSM:e.controlHeightSM*.625,starSizeLG:e.controlHeightLG*.625,starHoverScale:"scale(1.1)",starBg:e.colorFillContent}),qe=Ie("Rate",e=>{const t=Re(e,{});return We(t)},ke),Je=e=>typeof e=="object"&&e!==null,ne=u.forwardRef((e,t)=>{const{prefixCls:r,className:s,rootClassName:h,style:x,tooltips:o,character:S=u.createElement(ze,null),disabled:d,size:w="middle",...C}=e,E=(H,{index:T})=>{if(!o)return H;const D=o[T];return Je(D)?u.createElement(ae,{...D},H):u.createElement(ae,{title:D},H)},{getPrefixCls:c,direction:n,className:i,style:N}=Ve("rate"),f=c("rate",r),[g,$]=qe(f),I={...N,...x},v=u.useContext(Ne),M=d??v;return u.createElement(Ye,{ref:t,character:S,characterRender:E,disabled:M,...C,className:Y(`${f}-${w}`,s,h,g,$,i),style:I,prefixCls:f,direction:n})}),nt=()=>{const[e,t]=u.useState([]),[r,s]=u.useState(!0),[h,x]=u.useState(!1),[o,S]=u.useState(null),[d]=R.useForm(),w=async()=>{try{s(!0);const n=await L.get("/api/movies");t(n.data)}catch{V.error("加载电影失败")}finally{s(!1)}};u.useEffect(()=>{w()},[]);const C=async()=>{try{const n=await d.validateFields(),i={...n,watchedAt:n.watchedAt?n.watchedAt.toISOString():null};o?(await L.put(`/api/movies/${o.id}`,i),V.success("更新成功")):(await L.post("/api/movies",i),V.success("创建成功")),x(!1),d.resetFields(),w()}catch{V.error("操作失败")}},E=async n=>{try{await L.delete(`/api/movies/${n}`),V.success("删除成功"),w()}catch{V.error("删除失败")}},c=[{title:"海报",dataIndex:"posterUrl",key:"posterUrl",render:n=>n?a.jsx("img",{src:n,alt:"poster",className:"w-12 h-16 rounded object-cover"}):a.jsx("div",{className:"w-12 h-16 bg-gray-100 rounded"})},{title:"标题",dataIndex:"title",key:"title",render:(n,i)=>a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:n}),a.jsx("div",{className:"text-xs text-gray-500",children:i.year})]})},{title:"导演",dataIndex:"director",key:"director"},{title:"评分",dataIndex:"rating",key:"rating",render:n=>a.jsx(ne,{disabled:!0,allowHalf:!0,defaultValue:n,style:{fontSize:12}})},{title:"观看时间",dataIndex:"watchedAt",key:"watchedAt",render:n=>n?te(n).format("YYYY-MM-DD"):"-"},{title:"操作",key:"action",render:(n,i)=>a.jsxs(ve,{children:[a.jsx(B,{type:"text",icon:a.jsx(Me,{}),onClick:()=>{S(i),d.setFieldsValue({...i,watchedAt:i.watchedAt?te(i.watchedAt):null}),x(!0)}}),a.jsx(we,{title:"确定删除?",onConfirm:()=>E(i.id),children:a.jsx(B,{type:"text",danger:!0,icon:a.jsx(be,{})})})]})}];return a.jsxs("div",{className:"p-4 md:p-6",children:[a.jsx(re,{className:"mb-6",bodyStyle:{padding:"12px 16px"},children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-xl font-bold",children:"电影管理"}),a.jsx(B,{type:"primary",icon:a.jsx(ye,{}),onClick:()=>{S(null),d.resetFields(),x(!0)},children:"添加电影"})]})}),a.jsx(re,{bodyStyle:{padding:0},className:"overflow-hidden",children:a.jsx(Se,{columns:c,dataSource:e,rowKey:"id",loading:r,scroll:{x:600},pagination:{defaultPageSize:10}})}),a.jsx(je,{title:o?"编辑电影":"添加电影",open:h,onOk:C,onCancel:()=>x(!1),children:a.jsxs(R,{form:d,layout:"vertical",children:[a.jsx(R.Item,{name:"title",label:"标题",rules:[{required:!0}],children:a.jsx(F,{prefix:a.jsx(Le,{})})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(R.Item,{name:"director",label:"导演",children:a.jsx(F,{})}),a.jsx(R.Item,{name:"year",label:"年份",children:a.jsx(F,{type:"number"})})]}),a.jsx(R.Item,{name:"rating",label:"评分 (0-5)",children:a.jsx(ne,{allowHalf:!0})}),a.jsx(R.Item,{name:"watchedAt",label:"观看时间",children:a.jsx(ge,{style:{width:"100%"}})}),a.jsx(R.Item,{name:"posterUrl",label:"海报链接",children:a.jsx(F,{placeholder:"https://..."})}),a.jsx(R.Item,{name:"review",label:"简评",children:a.jsx(F.TextArea,{rows:3})})]})})]})};export{nt as default};
