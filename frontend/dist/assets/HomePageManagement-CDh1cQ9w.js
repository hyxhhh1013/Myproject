import{r,a as F,g as je,P as p,n as Le,j as h,d as Y}from"./index-BhbzFmRm.js";import{a as Te,k as Fe,r as Pe,at as De,a4 as Ae,F as O,e as Oe,f as ae,C as oe,B as ie,I as V,c as He}from"./index-kBbHJYa7.js";import{g as pe,m as he,u as Ue,r as ge,Q as Ge,b as ve,h as xe,x as We,j as Ve,t as _e,k as Se,c as Be,p as Qe,d as qe,s as _}from"./index-CEnH4XFE.js";import{R as Xe}from"./UserOutlined-B1RR1i8_.js";import{U as Ke}from"./index-bMoq39ES.js";import{R as Ye}from"./UploadOutlined-Cvxgmm1P.js";import"./index-DcAOwtUU.js";import"./DownloadOutlined-DWBHGFBM.js";const ne=r.createContext({}),Ze=t=>{const{antCls:e,componentCls:s,iconCls:n,avatarBg:a,avatarColor:o,containerSize:c,containerSizeLG:i,containerSizeSM:m,textFontSize:l,textFontSizeLG:d,textFontSizeSM:S,iconFontSize:v,iconFontSizeLG:g,iconFontSizeSM:f,borderRadius:u,borderRadiusLG:x,borderRadiusSM:b,lineWidth:M,lineType:D}=t,k=(R,$,I,j)=>({width:R,height:R,borderRadius:"50%",fontSize:$,[`&${s}-square`]:{borderRadius:j},[`&${s}-icon`]:{fontSize:I,[`> ${n}`]:{margin:0}}});return{[s]:{...ge(t),position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:o,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:a,border:`${Ue(M)} ${D} transparent`,"&-image":{background:"transparent"},[`${e}-image-img`]:{display:"block"},...k(c,l,v,u),"&-lg":{...k(i,d,g,x)},"&-sm":{...k(m,S,f,b)},"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}}}},Je=t=>{const{componentCls:e,groupBorderColor:s,groupOverlapping:n,groupSpace:a}=t;return{[`${e}-group`]:{display:"inline-flex",[e]:{borderColor:s},"> *:not(:first-child)":{marginInlineStart:n}},[`${e}-group-popover`]:{[`${e} + ${e}`]:{marginInlineStart:a}}}},et=t=>{const{controlHeight:e,controlHeightLG:s,controlHeightSM:n,fontSize:a,fontSizeLG:o,fontSizeXL:c,fontSizeHeading3:i,marginXS:m,marginXXS:l,colorBorderBg:d}=t;return{containerSize:e,containerSizeLG:s,containerSizeSM:n,textFontSize:a,textFontSizeLG:a,textFontSizeSM:a,iconFontSize:Math.round((o+c)/2),iconFontSizeLG:i,iconFontSizeSM:a,groupSpace:l,groupOverlapping:-m,groupBorderColor:d}},ye=pe("Avatar",t=>{const{colorTextLightSolid:e,colorTextPlaceholder:s}=t,n=he(t,{avatarBg:s,avatarColor:e});return[Ze(n),Je(n)]},et),Ce=r.forwardRef((t,e)=>{const{prefixCls:s,shape:n,size:a,src:o,srcSet:c,icon:i,className:m,rootClassName:l,style:d,alt:S,draggable:v,children:g,crossOrigin:f,gap:u=4,onError:x,...b}=t,[M,D]=r.useState(1),[k,R]=r.useState(!1),[$,I]=r.useState(!0),j=r.useRef(null),P=r.useRef(null),H=Ge(e,j),{getPrefixCls:A,className:C,style:W}=ve("avatar"),L=r.useContext(ne),U=()=>{if(!P.current||!j.current)return;const E=P.current.offsetWidth,z=j.current.offsetWidth;E!==0&&z!==0&&u*2<z&&D(z-u*2<E?(z-u*2)/E:1)};r.useEffect(()=>{R(!0)},[]),r.useEffect(()=>{I(!0),D(1)},[o]),r.useEffect(U,[u]);const T=()=>{(x==null?void 0:x())!==!1&&I(!1)},y=Te(E=>a??(L==null?void 0:L.size)??E??"default"),B=Object.keys(typeof y=="object"?y||{}:{}).some(E=>["xs","sm","md","lg","xl","xxl"].includes(E)),Q=Fe(B),J=r.useMemo(()=>{if(typeof y!="object")return{};const E=Pe.find(Ie=>Q[Ie]),z=y[E];return z?{width:z,height:z,fontSize:z&&(i||g)?z/2:18}:{}},[Q,y,i,g]),N=A("avatar",s),q=xe(N),[ee,te]=ye(N,q),X=F({[`${N}-lg`]:y==="large",[`${N}-sm`]:y==="small"}),K=r.isValidElement(o),Re=n||(L==null?void 0:L.shape)||"circle",Me=F(N,X,C,`${N}-${Re}`,{[`${N}-image`]:K||o&&$,[`${N}-icon`]:!!i},te,q,m,l,ee),ke=typeof y=="number"?{width:y,height:y,fontSize:i?y/2:18}:{};let G;if(typeof o=="string"&&$)G=r.createElement("img",{src:o,draggable:v,srcSet:c,onError:T,alt:S,crossOrigin:f});else if(K)G=o;else if(i)G=i;else if(k||M!==1){const E=`scale(${M})`,z={msTransform:E,WebkitTransform:E,transform:E};G=r.createElement(We,{onResize:U},r.createElement("span",{className:`${N}-string`,ref:P,style:z},g))}else G=r.createElement("span",{className:`${N}-string`,style:{opacity:0},ref:P},g);return r.createElement("span",{...b,style:{...ke,...J,...W,...d},className:Me,ref:H},G)}),ce=t=>{const{size:e,shape:s}=r.useContext(ne),n=r.useMemo(()=>({size:t.size||e,shape:t.shape||s}),[t.size,t.shape,e,s]);return r.createElement(ne.Provider,{value:n},t.children)},tt=t=>{var j,P,H;const{getPrefixCls:e,direction:s}=r.useContext(Ve),{prefixCls:n,className:a,rootClassName:o,style:c,maxCount:i,maxStyle:m,size:l,shape:d,maxPopoverPlacement:S,maxPopoverTrigger:v,children:g,max:f}=t,u=e("avatar",n),x=`${u}-group`,b=xe(u),[M,D]=ye(u,b),k=F(x,{[`${x}-rtl`]:s==="rtl"},D,b,a,o,M),R=_e(g).map((A,C)=>Se(A,{key:`avatar-key-${C}`})),$=(f==null?void 0:f.count)||i,I=R.length;if($&&$<I){const A=R.slice(0,$),C=R.slice($,I),W=(f==null?void 0:f.style)||m,L=((j=f==null?void 0:f.popover)==null?void 0:j.trigger)||v||"hover",U=((P=f==null?void 0:f.popover)==null?void 0:P.placement)||S||"top",T={content:C,...f==null?void 0:f.popover,placement:U,trigger:L,rootClassName:F(`${x}-popover`,(H=f==null?void 0:f.popover)==null?void 0:H.rootClassName)};return A.push(r.createElement(De,{key:"avatar-popover-key",destroyOnHidden:!0,...T},r.createElement(Ce,{style:W},`+${I-$}`))),r.createElement(ce,{shape:d,size:l},r.createElement("div",{className:k,style:c},A))}return r.createElement(ce,{shape:d,size:l},r.createElement("div",{className:k,style:c},R))},we=Ce;we.Group=tt;const st=t=>{const{value:e,formatter:s,precision:n,decimalSeparator:a,groupSeparator:o="",prefixCls:c}=t;let i;if(typeof s=="function")i=s(e);else{const m=String(e),l=m.match(/^(-?)(\d*)(\.(\d+))?$/);if(!l||m==="-")i=m;else{const d=l[1];let S=l[2]||"0",v=l[4]||"";S=S.replace(/\B(?=(\d{3})+(?!\d))/g,o),typeof n=="number"&&(v=v.padEnd(n,"0").slice(0,n>0?n:0)),v&&(v=`${a}${v}`),i=[r.createElement("span",{key:"int",className:`${c}-content-value-int`},d,S),v&&r.createElement("span",{key:"decimal",className:`${c}-content-value-decimal`},v)]}}return r.createElement("span",{className:`${c}-content-value`},i)},nt=t=>{const{componentCls:e,marginXXS:s,padding:n,colorTextDescription:a,titleFontSize:o,colorTextHeading:c,contentFontSize:i,fontFamily:m}=t;return{[e]:{...ge(t),[`${e}-header`]:{paddingBottom:s,[`${e}-title`]:{color:a,fontSize:o}},[`${e}-skeleton`]:{paddingTop:n},[`${e}-content`]:{color:c,fontSize:i,fontFamily:m,[`${e}-content-value`]:{display:"inline-block",direction:"ltr"},[`${e}-content-prefix, ${e}-content-suffix`]:{display:"inline-block"},[`${e}-content-prefix`]:{marginInlineEnd:s},[`${e}-content-suffix`]:{marginInlineStart:s}}}}},rt=t=>{const{fontSizeHeading3:e,fontSize:s}=t;return{titleFontSize:s,contentFontSize:e}},at=pe("Statistic",t=>{const e=he(t,{});return nt(e)},rt),Z=r.forwardRef((t,e)=>{const{prefixCls:s,className:n,rootClassName:a,style:o,valueStyle:c,value:i=0,title:m,valueRender:l,prefix:d,suffix:S,loading:v=!1,formatter:g,precision:f,decimalSeparator:u=".",groupSeparator:x=",",onMouseEnter:b,onMouseLeave:M,styles:D,classNames:k,...R}=t,{getPrefixCls:$,direction:I,className:j,style:P,classNames:H,styles:A}=ve("statistic"),C=$("statistic",s),[W,L]=at(C),U={...t,decimalSeparator:u,groupSeparator:x,loading:v,value:i},[T,y]=Be([H,k],[A,D],{props:U}),B=r.createElement(st,{decimalSeparator:u,groupSeparator:x,prefixCls:C,formatter:g,precision:f,value:i}),Q=F(C,{[`${C}-rtl`]:I==="rtl"},j,n,a,T.root,W,L),J=F(`${C}-header`,T.header),N=F(`${C}-title`,T.title),q=F(`${C}-content`,T.content),ee=F(`${C}-content-prefix`,T.prefix),te=F(`${C}-content-suffix`,T.suffix),X=r.useRef(null);r.useImperativeHandle(e,()=>({nativeElement:X.current}));const K=Qe(R,{aria:!0,data:!0});return r.createElement("div",{...K,className:Q,style:{...y.root,...P,...o},ref:X,onMouseEnter:b,onMouseLeave:M},m&&r.createElement("div",{className:J,style:y.header},r.createElement("div",{className:N,style:y.title},m)),r.createElement(Ae,{paragraph:!1,loading:v,className:`${C}-skeleton`,active:!0},r.createElement("div",{className:q,style:{...c,...y.content}},d&&r.createElement("span",{className:ee,style:y.prefix},d),l?l(B):B,S&&r.createElement("span",{className:te,style:y.suffix},S))))}),ot=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function it(t,e){let s=t;const n=/\[[^\]]*]/g,a=(e.match(n)||[]).map(m=>m.slice(1,-1)),o=e.replace(n,"[]"),c=ot.reduce((m,[l,d])=>{if(m.includes(l)){const S=Math.floor(s/d);return s-=S*d,m.replace(new RegExp(`${l}+`,"g"),v=>{const g=v.length;return S.toString().padStart(g,"0")})}return m},o);let i=0;return c.replace(n,()=>{const m=a[i];return i+=1,m})}function ct(t,e,s){const{format:n=""}=e,a=new Date(t).getTime(),o=Date.now(),c=Math.max(s?a-o:o-a,0);return it(c,n)}const lt=1e3/60;function ut(t){return new Date(t).getTime()}const be=t=>{const{value:e,format:s="HH:mm:ss",onChange:n,onFinish:a,type:o,...c}=t,i=o==="countdown",[m,l]=r.useState(null),d=qe(()=>{const g=Date.now(),f=ut(e);l({});const u=i?f-g:g-f;return n==null||n(u),i&&f<g?(a==null||a(),!1):!0});r.useEffect(()=>{let g;const f=()=>{d()||window.clearInterval(g)},u=()=>{g=window.setInterval(f,lt)},x=()=>{window.clearInterval(g)};return u(),()=>{x()}},[e,i]),r.useEffect(()=>{l({})},[]);const S=(g,f)=>m?ct(g,{...f,format:s},i):"-",v=g=>Se(g,{title:void 0});return r.createElement(Z,{...c,value:e,valueRender:v,formatter:S})},mt=t=>r.createElement(be,{...t,type:"countdown"}),dt=r.memo(mt);Z.Timer=be;Z.Countdown=dt;var re={};re.match=xt;re.parse=Ee;var ft=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,pt=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,ht=/^(?:(min|max)-)?(.+)/,gt=/(em|rem|px|cm|mm|in|pt|pc)?$/,vt=/(dpi|dpcm|dppx)?$/;function xt(t,e){return Ee(t).some(function(s){var n=s.inverse,a=s.type==="all"||e.type===s.type;if(a&&n||!(a||n))return!1;var o=s.expressions.every(function(c){var i=c.feature,m=c.modifier,l=c.value,d=e[i];if(!d)return!1;switch(i){case"orientation":case"scan":return d.toLowerCase()===l.toLowerCase();case"width":case"height":case"device-width":case"device-height":l=me(l),d=me(d);break;case"resolution":l=ue(l),d=ue(d);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":l=le(l),d=le(d);break;case"grid":case"color":case"color-index":case"monochrome":l=parseInt(l,10)||1,d=parseInt(d,10)||0;break}switch(m){case"min":return d>=l;case"max":return d<=l;default:return d===l}});return o&&!n||!o&&n})}function Ee(t){return t.split(",").map(function(e){e=e.trim();var s=e.match(ft),n=s[1],a=s[2],o=s[3]||"",c={};return c.inverse=!!n&&n.toLowerCase()==="not",c.type=a?a.toLowerCase():"all",o=o.match(/\([^\)]+\)/g)||[],c.expressions=o.map(function(i){var m=i.match(pt),l=m[1].toLowerCase().match(ht);return{modifier:l[1],feature:l[2],value:m[2]}}),c})}function le(t){var e=Number(t),s;return e||(s=t.match(/^(\d+)\s*\/\s*(\d+)$/),e=s[1]/s[2]),e}function ue(t){var e=parseFloat(t),s=String(t).match(vt)[1];switch(s){case"dpcm":return e/2.54;case"dppx":return e*96;default:return e}}function me(t){var e=parseFloat(t),s=String(t).match(gt)[1];switch(s){case"em":return e*16;case"rem":return e*16;case"cm":return e*96/2.54;case"mm":return e*96/2.54/10;case"in":return e*96;case"pt":return e*72;case"pc":return e*72/12;default:return e}}var St=re.match,de=typeof window<"u"?window.matchMedia:null;function yt(t,e,s){var n=this,a;de&&!s&&(a=de.call(window,t)),a?(this.matches=a.matches,this.media=a.media,a.addListener(i)):(this.matches=St(t,e),this.media=t),this.addListener=o,this.removeListener=c,this.dispose=m;function o(l){a&&a.addListener(l)}function c(l){a&&a.removeListener(l)}function i(l){n.matches=l.matches,n.media=l.media}function m(){a&&a.removeListener(i)}}function Ct(t,e,s){return new yt(t,e,s)}var wt=Ct;const bt=je(wt);var Et=/[A-Z]/g,$t=/^ms-/,se={};function Nt(t){return"-"+t.toLowerCase()}function $e(t){if(se.hasOwnProperty(t))return se[t];var e=t.replace(Et,Nt);return se[t]=$t.test(e)?"-"+e:e}function zt(t,e){if(t===e)return!0;if(!t||!e)return!1;const s=Object.keys(t),n=Object.keys(e),a=s.length;if(n.length!==a)return!1;for(let o=0;o<a;o++){const c=s[o];if(t[c]!==e[c]||!Object.prototype.hasOwnProperty.call(e,c))return!1}return!0}const w=p.oneOfType([p.string,p.number]),Ne={all:p.bool,grid:p.bool,aural:p.bool,braille:p.bool,handheld:p.bool,print:p.bool,projection:p.bool,screen:p.bool,tty:p.bool,tv:p.bool,embossed:p.bool},Rt={orientation:p.oneOf(["portrait","landscape"]),scan:p.oneOf(["progressive","interlace"]),aspectRatio:p.string,deviceAspectRatio:p.string,height:w,deviceHeight:w,width:w,deviceWidth:w,color:p.bool,colorIndex:p.bool,monochrome:p.bool,resolution:w,type:Object.keys(Ne)},{type:Zt,...Mt}=Rt,kt={minAspectRatio:p.string,maxAspectRatio:p.string,minDeviceAspectRatio:p.string,maxDeviceAspectRatio:p.string,minHeight:w,maxHeight:w,minDeviceHeight:w,maxDeviceHeight:w,minWidth:w,maxWidth:w,minDeviceWidth:w,maxDeviceWidth:w,minColor:p.number,maxColor:p.number,minColorIndex:p.number,maxColorIndex:p.number,minMonochrome:p.number,maxMonochrome:p.number,minResolution:w,maxResolution:w,...Mt},It={...Ne,...kt};var jt={all:It};const Lt=t=>`not ${t}`,Tt=(t,e)=>{const s=$e(t);return typeof e=="number"&&(e=`${e}px`),e===!0?s:e===!1?Lt(s):`(${s}: ${e})`},Ft=t=>t.join(" and "),Pt=t=>{const e=[];return Object.keys(jt.all).forEach(s=>{const n=t[s];n!=null&&e.push(Tt(s,n))}),Ft(e)},Dt=r.createContext(void 0),At=t=>t.query||Pt(t),fe=t=>t?Object.keys(t).reduce((s,n)=>(s[$e(n)]=t[n],s),{}):void 0,ze=()=>{const t=r.useRef(!1);return r.useEffect(()=>{t.current=!0},[]),t.current},Ot=t=>{const e=r.useContext(Dt),s=()=>fe(t)||fe(e),[n,a]=r.useState(s);return r.useEffect(()=>{const o=s();zt(n,o)||a(o)},[t,e]),n},Ht=t=>{const e=()=>At(t),[s,n]=r.useState(e);return r.useEffect(()=>{const a=e();s!==a&&n(a)},[t]),s},Ut=(t,e)=>{const s=()=>bt(t,e||{},!!e),[n,a]=r.useState(s),o=ze();return r.useEffect(()=>{if(o){const c=s();return a(c),()=>{c&&c.dispose()}}},[t,e]),n},Gt=t=>{const[e,s]=r.useState(t.matches);return r.useEffect(()=>{const n=a=>{s(a.matches)};return t.addListener(n),s(t.matches),()=>{t.removeListener(n)}},[t]),e},Wt=(t,e,s)=>{const n=Ot(e),a=Ht(t);if(!a)throw new Error("Invalid or missing MediaQuery!");const o=Ut(a,n),c=Gt(o);return ze(),r.useEffect(()=>{},[c]),r.useEffect(()=>()=>{o&&o.dispose()},[]),c},Jt=()=>{const[t,e]=r.useState(!0),[s,n]=r.useState(!1),[a,o]=r.useState(null),[c]=O.useForm(),{user:i}=Le(),[m,l]=r.useState(""),d=Wt({maxWidth:768}),S=async()=>{try{e(!0);try{const u=await Y.get("/site-config");o(u.data)}catch(u){console.warn("Failed to fetch site config",u),o({})}try{const u=await Y.get(`/users/${(i==null?void 0:i.id)||1}`);l(u.data.avatar),c.setFieldsValue({title:u.data.title,subtitle:u.data.bio,github:v(u.data.socialMedia,"github"),linkedin:v(u.data.socialMedia,"linkedin"),twitter:v(u.data.socialMedia,"twitter")})}catch(u){if(u.response&&u.response.status===404)console.warn("User not found, using default values"),c.setFieldsValue({title:"Admin",subtitle:"Welcome"});else throw u}}catch(u){console.error("Failed to fetch data:",u),_.error("加载数据失败，请检查网络或后端服务")}finally{e(!1)}};r.useEffect(()=>{S()},[i]);const v=(u,x)=>{var b;return((b=u==null?void 0:u.find(M=>M.platform.toLowerCase()===x.toLowerCase()))==null?void 0:b.url)||""},g=async u=>{try{n(!0),await Y.put(`/users/${(i==null?void 0:i.id)||1}`,{title:u.title,bio:u.subtitle,socialMedia:[{platform:"github",url:u.github},{platform:"linkedin",url:u.linkedin},{platform:"twitter",url:u.twitter}]}),_.success("保存成功")}catch(x){console.error("Failed to save:",x),_.error("保存失败")}finally{n(!1)}},f=async u=>{const x=new FormData;x.append("image",u.file);try{const b=await Y.post(`/users/${(i==null?void 0:i.id)||1}/avatar`,x);l(b.data.data.avatar),_.success("头像上传成功")}catch{_.error("头像上传失败")}};return h.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[h.jsx("div",{className:"flex justify-between items-center",children:h.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"主页管理"})}),h.jsxs(Oe,{gutter:[16,16],children:[h.jsx(ae,{xs:24,md:16,children:h.jsx(oe,{title:"主页信息",loading:t,className:"rounded-xl shadow-sm",children:h.jsxs(O,{form:c,layout:"vertical",onFinish:g,children:[h.jsxs("div",{className:"flex flex-col md:flex-row items-center mb-6 gap-6",children:[h.jsx(we,{size:d?80:100,src:m,icon:h.jsx(Xe,{})}),h.jsx(Ke,{showUploadList:!1,beforeUpload:u=>(f({file:u}),!1),children:h.jsx(ie,{icon:h.jsx(Ye,{}),children:"更换头像"})})]}),h.jsx(O.Item,{name:"title",label:"主页标题 (Name/Title)",rules:[{required:!0}],children:h.jsx(V,{})}),h.jsx(O.Item,{name:"subtitle",label:"副标题 (Bio)",children:h.jsx(V.TextArea,{rows:3})}),h.jsx(O.Item,{name:"github",label:"GitHub 链接",children:h.jsx(V,{})}),h.jsx(O.Item,{name:"linkedin",label:"LinkedIn 链接",children:h.jsx(V,{})}),h.jsx(O.Item,{name:"twitter",label:"Twitter 链接",children:h.jsx(V,{})}),h.jsx(O.Item,{children:h.jsx(ie,{type:"primary",htmlType:"submit",loading:s,block:d,children:"保存修改"})})]})})}),h.jsx(ae,{xs:24,md:8,children:h.jsx(oe,{title:"访问统计",loading:t,className:"rounded-xl shadow-sm",children:h.jsx(Z,{title:"总访问量",value:(a==null?void 0:a.viewCount)||0,prefix:h.jsx(He,{})})})})]})]})};export{Jt as default};
