import{r,j as e,d as h}from"./index-DA1mDptU.js";import{C as I}from"./index-D8bVfsCA.js";import{F as k,M as j,T as u}from"./index-MtB7_Q9R.js";import{B as d,S as M,i as S}from"./index-BXfGwkoA.js";import{I as N,s as m}from"./index-CcWkhPZ4.js";import{a as $,R as C}from"./DeleteOutlined-DBmt2RbQ.js";import"./index-DcAOwtUU.js";var O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};function p(){return p=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(i[c]=l[c])}return i},p.apply(this,arguments)}const V=(i,n)=>r.createElement(N,p({},i,{ref:n,icon:O})),L=r.forwardRef(V),H=()=>{const[i,n]=r.useState([]),[l,c]=r.useState(!0),[a,y]=r.useState(null),[g,x]=r.useState(!1),w=async()=>{try{c(!0);const t=await h.get("/messages");n(t.data)}catch(t){console.error("Failed to fetch messages:",t),m.error("加载留言失败")}finally{c(!1)}};r.useEffect(()=>{w()},[]);const f=async t=>{try{await h.patch(`/messages/${t}/read`),m.success("已标记为已读"),n(s=>s.map(o=>o.id===t?{...o,isRead:!0}:o))}catch{m.error("操作失败")}},b=async t=>{try{await h.delete(`/api/messages/${t}`),m.success("删除成功"),n(s=>s.filter(o=>o.id!==t)),(a==null?void 0:a.id)===t&&x(!1)}catch{m.error("删除失败")}},R=t=>{y(t),x(!0),t.isRead||f(t.id)},v=[{title:"状态",dataIndex:"isRead",key:"isRead",width:80,render:t=>t?e.jsx(u,{color:"default",children:"已读"}):e.jsx(u,{color:"red",children:"未读"})},{title:"姓名",dataIndex:"name",key:"name",width:150},{title:"邮箱",dataIndex:"email",key:"email",width:200},{title:"主题",dataIndex:"subject",key:"subject",ellipsis:!0},{title:"时间",dataIndex:"createdAt",key:"createdAt",width:180,render:t=>new Date(t).toLocaleString()},{title:"操作",key:"action",width:150,render:(t,s)=>e.jsxs(M,{size:"small",children:[e.jsx(d,{type:"text",icon:e.jsx(S,{}),onClick:()=>R(s)}),!s.isRead&&e.jsx(d,{type:"text",icon:e.jsx($,{}),onClick:()=>f(s.id),title:"标记为已读"}),e.jsx(d,{type:"text",danger:!0,icon:e.jsx(C,{}),onClick:()=>{j.confirm({title:"确定删除?",onOk:()=>b(s.id)})}})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"留言管理"}),e.jsx(I,{children:e.jsx(k,{columns:v,dataSource:i,rowKey:"id",loading:l})}),e.jsx(j,{title:"留言详情",open:g,onCancel:()=>x(!1),footer:[e.jsx(d,{onClick:()=>x(!1),children:"关闭"},"close"),e.jsx(d,{type:"primary",icon:e.jsx(L,{}),href:`mailto:${a==null?void 0:a.email}?subject=Re: ${a==null?void 0:a.subject}`,children:"回复邮件"},"reply")],children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"发送人："}),e.jsxs("span",{className:"font-medium",children:[a.name," <",a.email,">"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"时间："}),e.jsx("span",{children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"主题："}),e.jsx("span",{className:"font-medium",children:a.subject})]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 min-h-[100px] whitespace-pre-wrap",children:a.content})]})})]})};export{H as default};
