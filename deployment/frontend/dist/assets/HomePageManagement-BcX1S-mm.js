import{r as s,a as F,n as ye,j as c,d as _}from"./index-DA1mDptU.js";import{F as A,R as Ce,C as se,I as D}from"./index-BktCRfXg.js";import{C as ne}from"./index-D8bVfsCA.js";import{g as oe,m as ie,u as $e,r as ce,E as ze,a as le,k as me,Y as we,C as Ee,t as be,c as de,I as Ne,d as je,p as Re,e as Ie,s as U}from"./index-CcWkhPZ4.js";import{u as Te,a as Fe,r as ke,q as Pe,B as re,i as Me}from"./index-BXfGwkoA.js";import{a as Le,U as Ae}from"./index-CHqQizDv.js";import{R as Be}from"./UploadOutlined-B9Wss_5y.js";import"./index-DcAOwtUU.js";import"./DeleteOutlined-DBmt2RbQ.js";const ee=s.createContext({}),He=n=>{const{antCls:t,componentCls:a,iconCls:o,avatarBg:i,avatarColor:l,containerSize:d,containerSizeLG:r,containerSizeSM:m,textFontSize:f,textFontSizeLG:S,textFontSizeSM:h,iconFontSize:g,iconFontSizeLG:u,iconFontSizeSM:e,borderRadius:p,borderRadiusLG:x,borderRadiusSM:b,lineWidth:P,lineType:M}=n,N=(E,$,j,R)=>({width:E,height:E,borderRadius:"50%",fontSize:$,[`&${a}-square`]:{borderRadius:R},[`&${a}-icon`]:{fontSize:j,[`> ${o}`]:{margin:0}}});return{[a]:{...ce(n),position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:l,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:i,border:`${$e(P)} ${M} transparent`,"&-image":{background:"transparent"},[`${t}-image-img`]:{display:"block"},...N(d,f,g,p),"&-lg":{...N(r,S,u,x)},"&-sm":{...N(m,h,e,b)},"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}}}},Ge=n=>{const{componentCls:t,groupBorderColor:a,groupOverlapping:o,groupSpace:i}=n;return{[`${t}-group`]:{display:"inline-flex",[t]:{borderColor:a},"> *:not(:first-child)":{marginInlineStart:o}},[`${t}-group-popover`]:{[`${t} + ${t}`]:{marginInlineStart:i}}}},Oe=n=>{const{controlHeight:t,controlHeightLG:a,controlHeightSM:o,fontSize:i,fontSizeLG:l,fontSizeXL:d,fontSizeHeading3:r,marginXS:m,marginXXS:f,colorBorderBg:S}=n;return{containerSize:t,containerSizeLG:a,containerSizeSM:o,textFontSize:i,textFontSizeLG:i,textFontSizeSM:i,iconFontSize:Math.round((l+d)/2),iconFontSizeLG:r,iconFontSizeSM:i,groupSpace:f,groupOverlapping:-m,groupBorderColor:S}},ue=oe("Avatar",n=>{const{colorTextLightSolid:t,colorTextPlaceholder:a}=n,o=ie(n,{avatarBg:a,avatarColor:t});return[He(o),Ge(o)]},Oe),fe=s.forwardRef((n,t)=>{const{prefixCls:a,shape:o,size:i,src:l,srcSet:d,icon:r,className:m,rootClassName:f,style:S,alt:h,draggable:g,children:u,crossOrigin:e,gap:p=4,onError:x,...b}=n,[P,M]=s.useState(1),[N,E]=s.useState(!1),[$,j]=s.useState(!0),R=s.useRef(null),k=s.useRef(null),B=ze(t,R),{getPrefixCls:L,className:y,style:O}=le("avatar"),I=s.useContext(ee),H=()=>{if(!k.current||!R.current)return;const C=k.current.offsetWidth,w=R.current.offsetWidth;C!==0&&w!==0&&p*2<w&&M(w-p*2<C?(w-p*2)/C:1)};s.useEffect(()=>{E(!0)},[]),s.useEffect(()=>{j(!0),M(1)},[l]),s.useEffect(H,[p]);const T=()=>{(x==null?void 0:x())!==!1&&j(!1)},v=Te(C=>i??(I==null?void 0:I.size)??C??"default"),V=Object.keys(typeof v=="object"?v||{}:{}).some(C=>["xs","sm","md","lg","xl","xxl"].includes(C)),W=Fe(V),K=s.useMemo(()=>{if(typeof v!="object")return{};const C=ke.find(ve=>W[ve]),w=v[C];return w?{width:w,height:w,fontSize:w&&(r||u)?w/2:18}:{}},[W,v,r,u]),z=L("avatar",a),X=me(z),[Q,Z]=ue(z,X),q=F({[`${z}-lg`]:v==="large",[`${z}-sm`]:v==="small"}),Y=s.isValidElement(l),he=o||(I==null?void 0:I.shape)||"circle",Se=F(z,q,y,`${z}-${he}`,{[`${z}-image`]:Y||l&&$,[`${z}-icon`]:!!r},Z,X,m,f,Q),xe=typeof v=="number"?{width:v,height:v,fontSize:r?v/2:18}:{};let G;if(typeof l=="string"&&$)G=s.createElement("img",{src:l,draggable:g,srcSet:d,onError:T,alt:h,crossOrigin:e});else if(Y)G=l;else if(r)G=r;else if(N||P!==1){const C=`scale(${P})`,w={msTransform:C,WebkitTransform:C,transform:C};G=s.createElement(we,{onResize:H},s.createElement("span",{className:`${z}-string`,ref:k,style:w},u))}else G=s.createElement("span",{className:`${z}-string`,style:{opacity:0},ref:k},u);return s.createElement("span",{...b,style:{...xe,...K,...O,...S},className:Se,ref:B},G)}),ae=n=>{const{size:t,shape:a}=s.useContext(ee),o=s.useMemo(()=>({size:n.size||t,shape:n.shape||a}),[n.size,n.shape,t,a]);return s.createElement(ee.Provider,{value:o},n.children)},De=n=>{var R,k,B;const{getPrefixCls:t,direction:a}=s.useContext(Ee),{prefixCls:o,className:i,rootClassName:l,style:d,maxCount:r,maxStyle:m,size:f,shape:S,maxPopoverPlacement:h,maxPopoverTrigger:g,children:u,max:e}=n,p=t("avatar",o),x=`${p}-group`,b=me(p),[P,M]=ue(p,b),N=F(x,{[`${x}-rtl`]:a==="rtl"},M,b,i,l,P),E=be(u).map((L,y)=>de(L,{key:`avatar-key-${y}`})),$=(e==null?void 0:e.count)||r,j=E.length;if($&&$<j){const L=E.slice(0,$),y=E.slice($,j),O=(e==null?void 0:e.style)||m,I=((R=e==null?void 0:e.popover)==null?void 0:R.trigger)||g||"hover",H=((k=e==null?void 0:e.popover)==null?void 0:k.placement)||h||"top",T={content:y,...e==null?void 0:e.popover,placement:H,trigger:I,rootClassName:F(`${x}-popover`,(B=e==null?void 0:e.popover)==null?void 0:B.rootClassName)};return L.push(s.createElement(Le,{key:"avatar-popover-key",destroyOnHidden:!0,...T},s.createElement(fe,{style:O},`+${j-$}`))),s.createElement(ae,{shape:S,size:f},s.createElement("div",{className:N,style:d},L))}return s.createElement(ae,{shape:S,size:f},s.createElement("div",{className:N,style:d},E))},pe=fe;pe.Group=De;var Ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};function te(){return te=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},te.apply(this,arguments)}const Ve=(n,t)=>s.createElement(Ne,te({},n,{ref:t,icon:Ue})),We=s.forwardRef(Ve),Xe=n=>{const{value:t,formatter:a,precision:o,decimalSeparator:i,groupSeparator:l="",prefixCls:d}=n;let r;if(typeof a=="function")r=a(t);else{const m=String(t),f=m.match(/^(-?)(\d*)(\.(\d+))?$/);if(!f||m==="-")r=m;else{const S=f[1];let h=f[2]||"0",g=f[4]||"";h=h.replace(/\B(?=(\d{3})+(?!\d))/g,l),typeof o=="number"&&(g=g.padEnd(o,"0").slice(0,o>0?o:0)),g&&(g=`${i}${g}`),r=[s.createElement("span",{key:"int",className:`${d}-content-value-int`},S,h),g&&s.createElement("span",{key:"decimal",className:`${d}-content-value-decimal`},g)]}}return s.createElement("span",{className:`${d}-content-value`},r)},qe=n=>{const{componentCls:t,marginXXS:a,padding:o,colorTextDescription:i,titleFontSize:l,colorTextHeading:d,contentFontSize:r,fontFamily:m}=n;return{[t]:{...ce(n),[`${t}-header`]:{paddingBottom:a,[`${t}-title`]:{color:i,fontSize:l}},[`${t}-skeleton`]:{paddingTop:o},[`${t}-content`]:{color:d,fontSize:r,fontFamily:m,[`${t}-content-value`]:{display:"inline-block",direction:"ltr"},[`${t}-content-prefix, ${t}-content-suffix`]:{display:"inline-block"},[`${t}-content-prefix`]:{marginInlineEnd:a},[`${t}-content-suffix`]:{marginInlineStart:a}}}}},Ye=n=>{const{fontSizeHeading3:t,fontSize:a}=n;return{titleFontSize:a,contentFontSize:t}},_e=oe("Statistic",n=>{const t=ie(n,{});return qe(t)},Ye),J=s.forwardRef((n,t)=>{const{prefixCls:a,className:o,rootClassName:i,style:l,valueStyle:d,value:r=0,title:m,valueRender:f,prefix:S,suffix:h,loading:g=!1,formatter:u,precision:e,decimalSeparator:p=".",groupSeparator:x=",",onMouseEnter:b,onMouseLeave:P,styles:M,classNames:N,...E}=n,{getPrefixCls:$,direction:j,className:R,style:k,classNames:B,styles:L}=le("statistic"),y=$("statistic",a),[O,I]=_e(y),H={...n,decimalSeparator:p,groupSeparator:x,loading:g,value:r},[T,v]=je([B,N],[L,M],{props:H}),V=s.createElement(Xe,{decimalSeparator:p,groupSeparator:x,prefixCls:y,formatter:u,precision:e,value:r}),W=F(y,{[`${y}-rtl`]:j==="rtl"},R,o,i,T.root,O,I),K=F(`${y}-header`,T.header),z=F(`${y}-title`,T.title),X=F(`${y}-content`,T.content),Q=F(`${y}-content-prefix`,T.prefix),Z=F(`${y}-content-suffix`,T.suffix),q=s.useRef(null);s.useImperativeHandle(t,()=>({nativeElement:q.current}));const Y=Re(E,{aria:!0,data:!0});return s.createElement("div",{...Y,className:W,style:{...v.root,...k,...l},ref:q,onMouseEnter:b,onMouseLeave:P},m&&s.createElement("div",{className:K,style:v.header},s.createElement("div",{className:z,style:v.title},m)),s.createElement(Pe,{paragraph:!1,loading:g,className:`${y}-skeleton`,active:!0},s.createElement("div",{className:X,style:{...d,...v.content}},S&&s.createElement("span",{className:Q,style:v.prefix},S),f?f(V):V,h&&s.createElement("span",{className:Z,style:v.suffix},h))))}),Je=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Ke(n,t){let a=n;const o=/\[[^\]]*]/g,i=(t.match(o)||[]).map(m=>m.slice(1,-1)),l=t.replace(o,"[]"),d=Je.reduce((m,[f,S])=>{if(m.includes(f)){const h=Math.floor(a/S);return a-=h*S,m.replace(new RegExp(`${f}+`,"g"),g=>{const u=g.length;return h.toString().padStart(u,"0")})}return m},l);let r=0;return d.replace(o,()=>{const m=i[r];return r+=1,m})}function Qe(n,t,a){const{format:o=""}=t,i=new Date(n).getTime(),l=Date.now(),d=Math.max(a?i-l:l-i,0);return Ke(d,o)}const Ze=1e3/60;function et(n){return new Date(n).getTime()}const ge=n=>{const{value:t,format:a="HH:mm:ss",onChange:o,onFinish:i,type:l,...d}=n,r=l==="countdown",[m,f]=s.useState(null),S=Ie(()=>{const u=Date.now(),e=et(t);f({});const p=r?e-u:u-e;return o==null||o(p),r&&e<u?(i==null||i(),!1):!0});s.useEffect(()=>{let u;const e=()=>{S()||window.clearInterval(u)},p=()=>{u=window.setInterval(e,Ze)},x=()=>{window.clearInterval(u)};return p(),()=>{x()}},[t,r]),s.useEffect(()=>{f({})},[]);const h=(u,e)=>m?Qe(u,{...e,format:a},r):"-",g=u=>de(u,{title:void 0});return s.createElement(J,{...d,value:t,valueRender:g,formatter:h})},tt=n=>s.createElement(ge,{...n,type:"countdown"}),st=s.memo(tt);J.Timer=ge;J.Countdown=st;const ut=()=>{const[n,t]=s.useState(!0),[a,o]=s.useState(!1),[i,l]=s.useState(null),[d]=A.useForm(),{user:r}=ye(),[m,f]=s.useState(""),S=async()=>{try{t(!0);try{const e=await _.get("/api/site-config");l(e.data)}catch(e){console.warn("Failed to fetch site config",e),l({})}try{const e=await _.get(`/users/${(r==null?void 0:r.id)||1}`);f(e.data.avatar),d.setFieldsValue({title:e.data.title,subtitle:e.data.bio,github:h(e.data.socialMedia,"github"),linkedin:h(e.data.socialMedia,"linkedin"),twitter:h(e.data.socialMedia,"twitter")})}catch(e){if(e.response&&e.response.status===404)console.warn("User not found, using default values"),d.setFieldsValue({title:"Admin",subtitle:"Welcome"});else throw e}}catch(e){console.error("Failed to fetch data:",e),U.error("加载数据失败，请检查网络或后端服务")}finally{t(!1)}};s.useEffect(()=>{S()},[r]);const h=(e,p)=>{var x;return((x=e==null?void 0:e.find(b=>b.platform.toLowerCase()===p.toLowerCase()))==null?void 0:x.url)||""},g=async e=>{try{o(!0),await _.put(`/users/${(r==null?void 0:r.id)||1}`,{title:e.title,bio:e.subtitle}),U.success("保存成功")}catch(p){console.error("Failed to save:",p),U.error("保存失败")}finally{o(!1)}},u=async e=>{const p=new FormData;p.append("image",e.file);try{const x=await _.post(`/users/${(r==null?void 0:r.id)||1}/avatar`,p);f(x.data.data.avatar),U.success("头像上传成功")}catch{U.error("头像上传失败")}};return c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsx("h2",{className:"text-2xl font-bold",children:"主页管理"})}),c.jsxs(Ce,{gutter:16,children:[c.jsx(se,{span:16,children:c.jsx(ne,{title:"主页信息",loading:n,children:c.jsxs(A,{form:d,layout:"vertical",onFinish:g,children:[c.jsxs("div",{className:"flex items-center mb-6 gap-6",children:[c.jsx(pe,{size:100,src:m,icon:c.jsx(We,{})}),c.jsx(Ae,{showUploadList:!1,beforeUpload:e=>(u({file:e}),!1),children:c.jsx(re,{icon:c.jsx(Be,{}),children:"更换头像"})})]}),c.jsx(A.Item,{name:"title",label:"主页标题 (Name/Title)",rules:[{required:!0}],children:c.jsx(D,{})}),c.jsx(A.Item,{name:"subtitle",label:"副标题 (Bio)",children:c.jsx(D.TextArea,{rows:3})}),c.jsx(A.Item,{name:"github",label:"GitHub 链接",children:c.jsx(D,{})}),c.jsx(A.Item,{name:"linkedin",label:"LinkedIn 链接",children:c.jsx(D,{})}),c.jsx(A.Item,{name:"twitter",label:"Twitter 链接",children:c.jsx(D,{})}),c.jsx(A.Item,{children:c.jsx(re,{type:"primary",htmlType:"submit",loading:a,children:"保存修改"})})]})})}),c.jsx(se,{span:8,children:c.jsx(ne,{title:"访问统计",loading:n,children:c.jsx(J,{title:"总访问量",value:(i==null?void 0:i.viewCount)||0,prefix:c.jsx(Me,{})})})})]})]})};export{ut as default};
