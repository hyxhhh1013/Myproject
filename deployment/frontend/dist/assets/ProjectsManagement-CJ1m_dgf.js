import{r as n,j as t,d as x}from"./index-DA1mDptU.js";import{F as d,I as f}from"./index-BktCRfXg.js";import{B as I,c as S,T as v,S as w}from"./index-BXfGwkoA.js";import{F as C,M,T as D}from"./index-MtB7_Q9R.js";import{U as F}from"./index-CHqQizDv.js";import{I as T,s as p}from"./index-CcWkhPZ4.js";import{I as E,R as _,P as G}from"./index-HdzSYL8i.js";import{R as B}from"./DeleteOutlined-DBmt2RbQ.js";import"./index-DcAOwtUU.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"}}]},name:"github",theme:"outlined"};function U(){return U=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(a[i]=l[i])}return a},U.apply(this,arguments)}const V=(a,r)=>n.createElement(T,U({},a,{ref:r,icon:J})),R=n.forwardRef(V);var H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function O(){return O=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(a[i]=l[i])}return a},O.apply(this,arguments)}const W=(a,r)=>n.createElement(T,O({},a,{ref:r,icon:H})),L=n.forwardRef(W),re=()=>{const[a,r]=n.useState([]),[l,i]=n.useState(!0),[N,g]=n.useState(!1),[j,y]=n.useState(null),[m,h]=n.useState([]),[u]=d.useForm(),b=async()=>{try{i(!0);const e=await x.get("/projects"),o=(e.data.data||e.data).map(c=>({...c,technologies:typeof c.technologies=="string"&&c.technologies.startsWith("[")?JSON.parse(c.technologies):typeof c.technologies=="string"?c.technologies.split(","):c.technologies}));r(o)}catch(e){console.error("Failed to fetch projects:",e),p.error("加载项目失败")}finally{i(!1)}};n.useEffect(()=>{b()},[]);const k=async()=>{try{const e=await u.validateFields(),s=new FormData;s.append("userId","1"),s.append("title",e.title),s.append("description",e.description),s.append("startDate",new Date().toISOString());const o=e.technologies.split(",").map(c=>c.trim());s.append("technologies",JSON.stringify(o)),e.githubUrl&&s.append("githubUrl",e.githubUrl),e.demoUrl&&s.append("demoUrl",e.demoUrl),m.length>0&&m[0].originFileObj&&s.append("image",m[0].originFileObj),j?(await x.put(`/projects/${j.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}),p.success("更新成功")):(await x.post("/projects",s,{headers:{"Content-Type":"multipart/form-data"}}),p.success("创建成功")),g(!1),u.resetFields(),h([]),y(null),b()}catch(e){console.error("Failed to save project:",e),p.error("保存失败")}},P=async e=>{try{await x.delete(`/projects/${e}`),p.success("删除成功"),b()}catch{p.error("删除失败")}},$=e=>{y(e);let s="";if(Array.isArray(e.technologies))s=e.technologies.join(", ");else if(typeof e.technologies=="string")try{const o=JSON.parse(e.technologies);Array.isArray(o)?s=o.join(", "):s=e.technologies}catch{s=e.technologies}u.setFieldsValue({title:e.title,description:e.description,technologies:s,githubUrl:e.githubUrl,demoUrl:e.demoUrl}),e.imageUrl?h([{uid:"-1",name:"current-image.png",status:"done",url:e.imageUrl}]):h([]),g(!0)},z={onRemove:()=>{h([])},beforeUpload:e=>e.type.startsWith("image/")?(h([e]),!1):(p.error(`${e.name} 不是图片文件`),F.LIST_IGNORE),fileList:m,maxCount:1,listType:"picture-card"},A=[{title:"封面",dataIndex:"imageUrl",key:"imageUrl",width:100,render:e=>e?t.jsx(E,{src:e,width:80,height:50,style:{objectFit:"cover",borderRadius:4}}):t.jsx("div",{className:"w-20 h-12 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-400",children:"无图片"})},{title:"标题",dataIndex:"title",key:"title",render:e=>t.jsx("span",{className:"font-medium",children:e})},{title:"描述",dataIndex:"description",key:"description",ellipsis:{showTitle:!1},render:e=>t.jsx(v,{placement:"topLeft",title:e,children:e})},{title:"技术栈",dataIndex:"technologies",key:"technologies",render:e=>{let s=[];if(Array.isArray(e))s=e;else if(typeof e=="string")try{s=JSON.parse(e)}catch{s=e.split(",")}return t.jsx(w,{size:[0,8],wrap:!0,children:Array.isArray(s)&&s.map(o=>t.jsx(D,{color:"blue",children:o},o))})}},{title:"链接",key:"links",render:(e,s)=>t.jsxs(w,{children:[s.githubUrl&&t.jsx(v,{title:"GitHub",children:t.jsx("a",{href:s.githubUrl,target:"_blank",rel:"noopener noreferrer",children:t.jsx(R,{style:{fontSize:"18px",color:"#333"}})})}),s.demoUrl&&t.jsx(v,{title:"Demo",children:t.jsx("a",{href:s.demoUrl,target:"_blank",rel:"noopener noreferrer",children:t.jsx(L,{style:{fontSize:"18px",color:"#1890ff"}})})})]})},{title:"操作",key:"action",render:(e,s)=>t.jsxs(w,{size:"small",children:[t.jsx(I,{type:"text",icon:t.jsx(_,{}),onClick:()=>$(s)}),t.jsx(G,{title:"确定删除吗?",onConfirm:()=>P(s.id),children:t.jsx(I,{type:"text",danger:!0,icon:t.jsx(B,{})})})]})}];return t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"项目管理"}),t.jsx("p",{className:"text-gray-500",children:"管理您的项目，包括截图、标题、描述和技术栈"})]}),t.jsx(I,{type:"primary",icon:t.jsx(S,{}),onClick:()=>{y(null),u.resetFields(),h([]),g(!0)},children:"创建项目"})]}),t.jsx(C,{columns:A,dataSource:a,rowKey:"id",loading:l,pagination:{defaultPageSize:10}}),t.jsx(M,{title:j?"编辑项目":"创建新项目",open:N,onOk:k,onCancel:()=>g(!1),width:600,children:t.jsxs(d,{form:u,layout:"vertical",children:[t.jsx(d.Item,{label:"项目截图",children:t.jsx(F,{...z,children:m.length<1&&t.jsxs("div",{children:[t.jsx(S,{}),t.jsx("div",{style:{marginTop:8},children:"上传图片"})]})})}),t.jsx(d.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:t.jsx(f,{placeholder:"输入项目标题"})}),t.jsx(d.Item,{name:"description",label:"描述",children:t.jsx(f.TextArea,{rows:4,placeholder:"输入项目描述"})}),t.jsx(d.Item,{name:"technologies",label:"技术栈 (用逗号分隔)",children:t.jsx(f,{placeholder:"例如：React, TypeScript, Node.js"})}),t.jsx(d.Item,{name:"githubUrl",label:"GitHub链接",children:t.jsx(f,{prefix:t.jsx(R,{}),placeholder:"https://github.com/..."})}),t.jsx(d.Item,{name:"demoUrl",label:"Demo/预览链接",children:t.jsx(f,{prefix:t.jsx(L,{}),placeholder:"https://..."})})]})})]})};export{re as default};
